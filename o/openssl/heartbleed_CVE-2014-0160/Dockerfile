FROM ubuntu:latest
MAINTAINER Medici.Yan@Gmail.com

WORKDIR /tmp
ENV BASE_URL https://raw.githubusercontent.com/Medicean/VulApps/master/o/openssl/heartbleed_CVE-2014-0160/

RUN apt-get update \
    && apt-get install -y wget apache2 

RUN wget ${BASE_URL}/openssl_1.0.1c-4ubuntu8_amd64.deb \
    && dpkg --force-all -i openssl_1.0.1c-4ubuntu8_amd64.deb \
    && wget ${BASE_URL}/libssl1.0.0_1.0.1c-4ubuntu8_amd64.deb \
    && dpkg --force-all -i libssl1.0.0_1.0.1c-4ubuntu8_amd64.deb \
    && rm -f libssl1.0.0_1.0.1c-4ubuntu8_amd64.deb \
    && rm -f openssl_1.0.1c-4ubuntu8_amd64.deb

RUN mkdir /etc/apache2/ssl \
    && openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt -subj "/C=US/ST=Denial/L=Springfield/O=Dis/CN=localhost" \
    && rm -f /etc/apache2/sites-available/default-ssl.conf \
    && wget -O /etc/apache2/sites-available/default-ssl.conf ${BASE_URL}/default-ssl.conf \
    && a2enmod ssl \
    && a2ensite default-ssl.conf

EXPOSE 443

ENV APACHE_RUN_USER www-data
ENV APACHE_RUN_GROUP www-data
ENV APACHE_LOG_DIR /var/log/apache2

CMD ["/usr/sbin/apache2ctl", "-D", "FOREGROUND"]